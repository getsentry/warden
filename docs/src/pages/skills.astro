---
import Base from '../layouts/Base.astro';
import Terminal from '../components/Terminal.astro';
import { Code } from 'astro:components';

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<Base title="Skills" description="Built-in and custom skills for Warden">
  <h1>Skills</h1>

  <p>Skills are AI agents that analyze your pull requests. Each skill has a specific purpose, a prompt that guides the analysis, and restrictions on what tools it can use.</p>

  <h2>Built-in Skills</h2>

  <h3>security-review</h3>

  <p>Scans code changes for security vulnerabilities. This skill analyzes diffs for common security issues and reports findings with severity levels.</p>

  <h4>What It Checks</h4>

  <ul>
    <li><strong>Injection Vulnerabilities</strong> — SQL injection, command injection, XSS, template injection, path traversal</li>
    <li><strong>Authentication & Authorization</strong> — Missing auth checks, improper session handling, authorization bypass, hardcoded credentials</li>
    <li><strong>Data Security</strong> — Sensitive data exposure (PII, API keys), insecure storage, missing encryption, logging secrets</li>
    <li><strong>Dependencies</strong> — Known vulnerable packages, insecure configurations</li>
    <li><strong>General Security</strong> — Insecure crypto, race conditions, information disclosure, missing input validation</li>
  </ul>

  <h4>Severity Levels</h4>

  <table>
    <thead>
      <tr>
        <th>Level</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>critical</code></td>
        <td>Actively exploitable, high impact vulnerability</td>
      </tr>
      <tr>
        <td><code>high</code></td>
        <td>Exploitable with moderate effort</td>
      </tr>
      <tr>
        <td><code>medium</code></td>
        <td>Potential vulnerability, needs review</td>
      </tr>
      <tr>
        <td><code>low</code></td>
        <td>Minor security concern</td>
      </tr>
      <tr>
        <td><code>info</code></td>
        <td>Security-related observation</td>
      </tr>
    </tbody>
  </table>

  <h4>Usage</h4>

  <Terminal title="warden.toml" showCopy={true}>
    <Code
      code={`[[triggers]]
name = "Security Review"
event = "pull_request"
actions = ["opened", "synchronize"]
skill = "security-review"`}
      lang="toml"
      theme="vitesse-black"
    />
  </Terminal>

  <h2>Custom Skills</h2>

  <p>Define your own skills in <code>.warden/skills/</code> as TOML files.</p>

  <h3>Skill Definition</h3>

  <Terminal title=".warden/skills/code-review.toml" showCopy={true}>
    <Code
      code={`name = "code-review"
description = "General code quality review"

prompt = """
You are a code reviewer. Analyze the pull request for:
- Code clarity and readability
- Potential bugs or logic errors
- Performance concerns
- Best practices violations

Provide constructive feedback with specific suggestions.
"""

[tools]
allowed = ["Read", "Grep", "Glob"]
denied = ["Write", "Edit", "Bash"]`}
      lang="toml"
      theme="vitesse-black"
    />
  </Terminal>

  <h3>Skill Fields</h3>

  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Required</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>name</code></td>
        <td>Yes</td>
        <td>Unique identifier (kebab-case)</td>
      </tr>
      <tr>
        <td><code>description</code></td>
        <td>Yes</td>
        <td>Human-readable purpose</td>
      </tr>
      <tr>
        <td><code>prompt</code></td>
        <td>Yes</td>
        <td>System instructions for the AI agent</td>
      </tr>
      <tr>
        <td><code>tools.allowed</code></td>
        <td>No</td>
        <td>Tools the skill can use</td>
      </tr>
      <tr>
        <td><code>tools.denied</code></td>
        <td>No</td>
        <td>Tools the skill cannot use</td>
      </tr>
    </tbody>
  </table>

  <h3>Available Tools</h3>

  <p>Skills can use Claude Code's built-in tools:</p>

  <table>
    <thead>
      <tr>
        <th>Tool</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>Read</code></td>
        <td>Read file contents</td>
      </tr>
      <tr>
        <td><code>Grep</code></td>
        <td>Search file contents with regex</td>
      </tr>
      <tr>
        <td><code>Glob</code></td>
        <td>Find files by pattern</td>
      </tr>
      <tr>
        <td><code>WebFetch</code></td>
        <td>Fetch content from URLs (e.g., CVE databases)</td>
      </tr>
      <tr>
        <td><code>Write</code></td>
        <td>Write files (usually denied for review skills)</td>
      </tr>
      <tr>
        <td><code>Edit</code></td>
        <td>Edit files (usually denied for review skills)</td>
      </tr>
      <tr>
        <td><code>Bash</code></td>
        <td>Run shell commands (usually denied for security)</td>
      </tr>
    </tbody>
  </table>

  <h3>Using Custom Skills</h3>

  <p>Reference your custom skill by name in triggers:</p>

  <Terminal title="warden.toml" showCopy={true}>
    <Code
      code={`[[triggers]]
name = "Code Review"
event = "pull_request"
actions = ["opened"]
skill = "code-review"  # Matches .warden/skills/code-review.toml`}
      lang="toml"
      theme="vitesse-black"
    />
  </Terminal>

  <h2>Output Format</h2>

  <p>Skills return findings in a structured format. Each finding includes:</p>

  <ul>
    <li><strong>Severity</strong> — How serious the issue is</li>
    <li><strong>Title</strong> — Brief description of the issue</li>
    <li><strong>Description</strong> — Detailed explanation</li>
    <li><strong>Location</strong> — File path and line numbers</li>
    <li><strong>Suggested Fix</strong> — Optional code suggestion</li>
  </ul>

  <p>Warden translates these findings into GitHub PR reviews with inline comments on the relevant lines.</p>
</Base>

<style>
  h1 {
    margin-bottom: 0.5rem;
  }

  h2 {
    margin-top: 2.5rem;
    margin-bottom: 1rem;
  }

  h3 {
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }

  h4 {
    margin-top: 1.25rem;
    margin-bottom: 0.5rem;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin: 1rem 0;
    font-size: 0.9rem;
  }

  th, td {
    text-align: left;
    padding: 0.75rem;
    border: 1px solid var(--border);
  }

  th {
    background: rgba(255, 255, 255, 0.03);
    font-weight: 600;
  }

  td code {
    background: rgba(255, 255, 255, 0.1);
    padding: 0.125rem 0.375rem;
    border-radius: 4px;
    font-size: 0.85em;
  }

  ul {
    padding-left: 1.5rem;
  }

  li {
    margin-bottom: 0.5rem;
  }
</style>
